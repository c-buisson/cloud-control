#!/usr/bin/ruby

guest=""
eval File.read("<%= kvm_folder %>/ENV")
require_relative "#{LIB}/lists.rb"

if ARGV[0].nil?
  puts "This script will download and place any ISO or Cloud Image to the correct location"
  puts "For Ubuntu ISO, go to: http://mirror.anl.gov/pub/ubuntu-iso/DVDs/ubuntu/"
  puts "For Ubuntu Cloud Image, go to: https://cloud-images.ubuntu.com/"
  puts "\nUsage: get_images.rb URL"
  exit 1
end

url=ARGV[0]
filename = ARGV[0].split(/\?/).first.split(/\//).last

if url.end_with? "img"
  type="cloud_image"
  puts "\nDownloading #{filename}...\n"
  system("wget #{url} -P #{CLOUD_IMAGES}") or raise "Error while downloading that Cloud Image. Wrong URL maybe?"
elsif url.end_with? "iso"
  type="iso"
  puts "\nDownloading #{filename}...\n"
  system("wget #{url} -P #{ISO}") or raise "Error while downloading that ISO. Wrong URL maybe?"
else
  puts "\nDoesn't support this type of source"
  puts "Must be ISO or Cloud Image\n"
  exit 1
end

  add_to_list "source", filename, type
  system("chown rundeck. <%= kvm_folder %>/lists/source_list.json")
  puts "Download completed!".cyan
